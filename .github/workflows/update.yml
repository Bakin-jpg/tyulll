name: Scrape YeahScore V5 (Debug Mode)

on:
  workflow_dispatch: # Bisa dijalankan manual
  schedule:
    - cron: '*/5 * * * *' # Tiap 15 menit

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Libraries & Browser
        run: |
          pip install playwright beautifulsoup4 requests
          playwright install chromium
          playwright install-deps

      - name: Run Scraper (Debug Enabled)
        run: python scrape.py

      # ========================================================
      # LANGKAH BARU: UPLOAD HASIL DEBUG
      # ========================================================
      - name: Upload Debug Screenshots & HTML
        if: always() # Tetap upload meskipun script error
        uses: actions/upload-artifact@v4
        with:
          name: debug-evidence
          path: |
            debug_view.png
            debug_source.html
          retention-days: 3 # File akan dihapus otomatis setelah 3 hari

      - name: Commit Results (matches.json only)
        # Hanya jalan jika script python sukses (tidak error)
        if: success() 
        run: |
          git config --global user.name "Bot Scraper"
          git config --global user.email "bot@github.com"
          # Kita hanya add json, jangan add file debug (png/html) ke repo agar tidak berat
          git add matches.json
          # Cek status dulu, kalau tidak ada perubahan jangan commit
          if [[ -n $(git status -s) ]]; then
            git commit -m "Update matches via Action"
            git pull --rebase origin main
            git push
          else
            echo "No changes to commit."
          fi
